<div class="dashboard-container">
  <!-- Toolbar -->
  <mat-toolbar color="primary" class="dashboard-toolbar">
    <span class="toolbar-title">
      <mat-icon svgIcon="dashboard"></mat-icon>
      PDF Invoice Manager
    </span>

    <span class="toolbar-spacer"></span>

    <button 
      mat-button 
      (click)="openUploadDialog()"
      matTooltip="Upload PDF Invoices">
      <mat-icon svgIcon="cloud_upload"></mat-icon>
      Upload
    </button>

    <span class="user-info">
      <mat-icon svgIcon="person"></mat-icon>
      {{ currentUser()?.username }}
      @if (isAdmin()) {
        <span class="admin-badge">ADMIN</span>
      }
    </span>

    @if (isAdmin()) {
      <button 
        mat-button 
        (click)="goToAdmin()"
        matTooltip="Admin Panel">
        <mat-icon svgIcon="admin_panel_settings"></mat-icon>
        Admin Panel
      </button>
    }

    <button 
      mat-button 
      (click)="logout()"
      matTooltip="Logout">
      <mat-icon svgIcon="logout"></mat-icon>
      Logout
    </button>
  </mat-toolbar>

  <!-- Main Content with Sidebar Layout -->
  <div class="dashboard-content">
    <!-- Left Sidebar - Filters -->
    <aside class="dashboard-sidebar">
      <app-filter-bar></app-filter-bar>
    </aside>

    <!-- Main Content Area -->
    <main class="dashboard-main">
      <div class="container">
        <!-- Page Header -->
        <div class="page-header">
          <h1>My Dashboard</h1>
          <p class="subtitle">Manage and track your invoices</p>
        </div>

        <!-- Statistics Cards -->
        <app-stats-cards></app-stats-cards>

        <!-- Analytics accordion (collapsed by default) -->
        <mat-accordion class="analytics-accordion">
          <mat-expansion-panel (opened)="onAnalyticsOpened()">
            <mat-expansion-panel-header>
              <mat-panel-title>
                <mat-icon svgIcon="analytics"></mat-icon>
                Analytics & Insights
              </mat-panel-title>
            </mat-expansion-panel-header>

            <ng-template matExpansionPanelContent>
              @if (invoiceLoading()) {
                <div class="chart-placeholder">
                  <mat-icon svgIcon="bar_chart"></mat-icon>
                  <span>Loading charts...</span>
                </div>
              } @else {
                @defer (when analyticsPanelLoaded()) {
                  <app-charts></app-charts>
                } @placeholder {
                  <div class="chart-placeholder">
                    <mat-icon svgIcon="bar_chart"></mat-icon>
                    <span>Loading charts...</span>
                  </div>
                }
              }
            </ng-template>
          </mat-expansion-panel>

          <mat-expansion-panel (opened)="onAdvancedAnalyticsOpened()">
            <mat-expansion-panel-header>
              <mat-panel-title>
                <mat-icon svgIcon="insights"></mat-icon>
                Advanced Analytics
              </mat-panel-title>
            </mat-expansion-panel-header>

            <ng-template matExpansionPanelContent>
              @if (invoiceLoading()) {
                <div class="chart-placeholder">
                  <mat-icon svgIcon="analytics"></mat-icon>
                  <span>Loading analytics...</span>
                </div>
              } @else {
                @defer (when advancedPanelLoaded()) {
                  <app-advanced-charts></app-advanced-charts>
                } @placeholder {
                  <div class="chart-placeholder">
                    <mat-icon svgIcon="analytics"></mat-icon>
                    <span>Loading analytics...</span>
                  </div>
                }
              }
            </ng-template>
          </mat-expansion-panel>
        </mat-accordion>

        <!-- Data Tables -->
        <mat-tab-group class="data-tables data-tabs" animationDuration="200ms" (selectedTabChange)="onTabChange($event)">
          <mat-tab>
            <ng-template mat-tab-label>
              <mat-icon svgIcon="receipt"></mat-icon>
              <span>Invoices ({{ invoicesTotal() }})</span>
            </ng-template>
            <app-invoice-table></app-invoice-table>
          </mat-tab>
          <mat-tab>
            <ng-template mat-tab-label>
              <mat-icon svgIcon="inventory_2"></mat-icon>
              <span>Items ({{ itemsTotal() }})</span>
            </ng-template>
            <app-item-table></app-item-table>
          </mat-tab>
        </mat-tab-group>
      </div>
    </main>
  </div>
</div>

